<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Comeback Generator - Shock Them Back!</title>
    <style>
        :root {
            --primary: #6e48aa;
            --secondary: #9d50bb;
            --accent: #4776e6;
            --text: #333;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 2rem;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }

        header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .main-content {
            padding: 2rem;
        }

        .input-section {
            margin-bottom: 2rem;
        }

        .input-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .insult-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            resize: none;
            min-height: 100px;
        }

        .insult-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(110, 72, 170, 0.2);
        }

        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #5d3d92;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .result-section {
            display: none;
            margin-top: 2rem;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--primary);
            font-weight: 600;
        }

        .comeback-box {
            background: #f8f9fa;
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 0 8px 8px 0;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .comeback-text {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1rem;
            color: var(--dark);
            margin-top: 1rem;
        }

        .ai-analysis {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 1rem;
            color: var(--secondary);
            font-weight: 500;
        }

        .ai-dot {
            width: 8px;
            height: 8px;
            background: var(--secondary);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .ai-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .ai-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.5; }
        }

        .history-section {
            margin-top: 2rem;
            display: none;
        }

        .history-title {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-weight: 600;
        }

        .history-item {
            background: #f1f3f5;
            padding: 0.8rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-insult {
            font-weight: 500;
        }

        .history-delete {
            color: var(--danger);
            cursor: pointer;
            font-size: 1rem;
        }

        footer {
            text-align: center;
            margin-top: 2rem;
            color: #6c757d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            
            .container {
                border-radius: 12px;
            }
            
            header {
                padding: 1.5rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AI PHẢN DAME</h1>
            <p class="subtitle">AI Sẽ giúp bạn xử lí khi người khác nói những câu nói lăng mạ. <br><i>made by Khoa Dev</i></p>
        </header>

        <div class="main-content">
            <div class="input-section">
                <label for="insult-input" class="input-label">Nhập lời lăng mạ bạn nhận được:</label>
                <textarea id="insult-input" class="insult-input" placeholder="Ví dụ: 'Mày có bị ngu không?'"></textarea>
                <div class="btn-group">
                    <button id="generate-btn" class="btn btn-primary">Trả lời phản dame</button>
                    <button id="new-btn" class="btn btn-danger">Làm mới</button>
                </div>
            </div>

            <div id="loading" class="loading">
                <div class="loading-spinner"></div>
                <p class="loading-text">KHOA AI đang phân tích lời xúc phạm và đưa ra phản ứng gây sốc hoàn hảo...</p>
                <div class="ai-analysis">
                    <div class="ai-dot"></div>
                    <div class="ai-dot"></div>
                    <div class="ai-dot"></div>
                    <span>Xử lý bằng KHOA AI</span>
                </div>
            </div>

            <div id="result-section" class="result-section">
                <h3 class="result-title">Đây là câu trả lời gây shocks</h3>
                <div class="comeback-box">
                    <p id="comeback-text" class="comeback-text"></p>
                </div>
                <div class="btn-group">
                    <button id="another-btn" class="btn btn-secondary">Câu nói khác</button>
                    <button id="save-btn" class="btn btn-primary">Lưu cái này</button>
                </div>
            </div>

            <div id="history-section" class="history-section">
                <h3 class="history-title">Những lời lăng mạ và đáp trả đã lưu của bạn</h3>
                <div id="history-list"></div>
            </div>
        </div>
    </div>

    <footer>
        <p>© 2025 KHOA AI Comeback Generator | Powered by KHOA AI</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const insultInput = document.getElementById('insult-input');
            const generateBtn = document.getElementById('generate-btn');
            const newBtn = document.getElementById('new-btn');
            const loadingSection = document.getElementById('loading');
            const resultSection = document.getElementById('result-section');
            const comebackText = document.getElementById('comeback-text');
            const anotherBtn = document.getElementById('another-btn');
            const saveBtn = document.getElementById('save-btn');
            const historySection = document.getElementById('history-section');
            const historyList = document.getElementById('history-list');

            // API Configuration
            const API_KEY = 'AIzaSyCOFBRKmDGipgq3cX2aI_74NfSfjZ_bYtE';
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

            // Load saved insults from localStorage
            let savedInsults = JSON.parse(localStorage.getItem('savedInsults')) || [];
            let currentInsult = '';
            let currentComeback = '';

            // Check if there are saved insults and show history
            if (savedInsults.length > 0) {
                historySection.style.display = 'block';
                renderHistory();
            }

            // Event Listeners
            generateBtn.addEventListener('click', generateComeback);
            newBtn.addEventListener('click', resetApp);
            anotherBtn.addEventListener('click', generateAnotherComeback);
            saveBtn.addEventListener('click', saveComeback);

            // Generate comeback function
            async function generateComeback() {
                const insult = insultInput.value.trim();
                
                if (!insult) {
                    alert('Please enter an insult first!');
                    return;
                }

                currentInsult = insult;
                
                // Show loading, hide result
                loadingSection.style.display = 'block';
                resultSection.style.display = 'none';
                
                try {
                    const prompt = `You are a witty AI that generates shocking, devastating comebacks to insults. 
                    The user received this insult: "${insult}". 
                    Generate a shocking, savage, and clever comeback that will leave the original insulter speechless. 
                    Make it brutal but can illegal. The response should be in the same language as the insult. 
                    trả lời bằng tiếng Việt ngắn gọn, khiến đối phương shock câm lặng vì quá shock, xúc phạm"`;
                    
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const data = await response.json();
                    const generatedText = data.candidates[0].content.parts[0].text;
                    
                    // Process the response
                    let comeback = generatedText;
                    
                    // If the response follows our format, extract parts
                    if (generatedText.includes('Comeback:')) {
                        const parts = generatedText.split('\n\nWhy it works:');
                        comeback = `<strong>${parts[0].replace('Comeback: ', '')}</strong><br><br><em>Why it works:</em> ${parts[1]}`;
                    }
                    
                    currentComeback = generatedText;
                    displayResult(comeback);
                    
                } catch (error) {
                    console.error('Error generating comeback:', error);
                    displayResult(`<strong>Error:</strong> Failed to generate comeback. Please try again.`);
                }
            }

            // Display result function
            function displayResult(text) {
                loadingSection.style.display = 'none';
                resultSection.style.display = 'block';
                comebackText.innerHTML = text;
                
                // Show history section if not already visible
                if (savedInsults.length > 0) {
                    historySection.style.display = 'block';
                }
            }

            // Generate another comeback for the same insult
            function generateAnotherComeback() {
                if (currentInsult) {
                    insultInput.value = currentInsult;
                    generateComeback();
                }
            }

            // Save the current insult and comeback
            function saveComeback() {
                if (currentInsult && currentComeback) {
                    // Check if this insult is already saved
                    const existingIndex = savedInsults.findIndex(item => item.insult === currentInsult);
                    
                    if (existingIndex >= 0) {
                        // Update existing entry
                        savedInsults[existingIndex].comeback = currentComeback;
                    } else {
                        // Add new entry
                        savedInsults.push({
                            insult: currentInsult,
                            comeback: currentComeback,
                            timestamp: new Date().toISOString()
                        });
                    }
                    
                    // Save to localStorage
                    localStorage.setItem('savedInsults', JSON.stringify(savedInsults));
                    
                    // Update UI
                    historySection.style.display = 'block';
                    renderHistory();
                    
                    // Show confirmation
                    alert('Comeback saved! You can view it in your history.');
                }
            }

            // Render history list
            function renderHistory() {
                historyList.innerHTML = '';
                
                savedInsults.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    // Extract just the first part of the comeback for display
                    let shortComeback = item.comeback;
                    if (shortComeback.includes('Comeback:')) {
                        shortComeback = shortComeback.split('Comeback:')[1].split('\n')[0].trim();
                    } else if (shortComeback.length > 50) {
                        shortComeback = shortComeback.substring(0, 50) + '...';
                    }
                    
                    historyItem.innerHTML = `
                        <span class="history-insult">"${item.insult}" → ${shortComeback}</span>
                        <span class="history-delete" data-index="${index}">×</span>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.history-delete').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        deleteHistoryItem(index);
                    });
                });
            }

            // Delete history item
            function deleteHistoryItem(index) {
                if (confirm('Delete this saved comeback?')) {
                    savedInsults.splice(index, 1);
                    localStorage.setItem('savedInsults', JSON.stringify(savedInsults));
                    renderHistory();
                    
                    if (savedInsults.length === 0) {
                        historySection.style.display = 'none';
                    }
                }
            }

            // Reset the app
            function resetApp() {
                if (confirm('Start fresh? This will clear the current input and results.')) {
                    insultInput.value = '';
                    currentInsult = '';
                    currentComeback = '';
                    loadingSection.style.display = 'none';
                    resultSection.style.display = 'none';
                    
                    // If New button is held for 3 seconds, also clear history
                    let timer;
                    const startTime = Date.now();
                    
                    newBtn.addEventListener('mousedown', function startTimer() {
                        timer = setTimeout(() => {
                            if (confirm('Also clear all saved comebacks?')) {
                                savedInsults = [];
                                localStorage.removeItem('savedInsults');
                                historySection.style.display = 'none';
                            }
                            newBtn.removeEventListener('mousedown', startTimer);
                        }, 3000);
                    });
                    
                    newBtn.addEventListener('mouseup', function() {
                        clearTimeout(timer);
                        newBtn.removeEventListener('mouseup', arguments.callee);
                    });
                    
                    newBtn.addEventListener('mouseleave', function() {
                        clearTimeout(timer);
                        newBtn.removeEventListener('mouseleave', arguments.callee);
                    });
                }
            }
        });
    </script>
</body>
</html>